(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{138:function(e,t){},268:function(e,t,n){e.exports=n(541)},273:function(e,t,n){},295:function(e,t){},335:function(e,t){},337:function(e,t){},350:function(e,t){},352:function(e,t){},360:function(e,t){},362:function(e,t){},372:function(e,t){},374:function(e,t){},382:function(e,t){},384:function(e,t){},392:function(e,t){},393:function(e,t){},395:function(e,t){},397:function(e,t){},399:function(e,t){},412:function(e,t){},417:function(e,t){},419:function(e,t){},428:function(e,t){},432:function(e,t){},433:function(e,t){},434:function(e,t){},441:function(e,t){},443:function(e,t){},448:function(e,t){},452:function(e,t){},453:function(e,t){},456:function(e,t){},462:function(e,t){},465:function(e,t){},467:function(e,t){},479:function(e,t){},481:function(e,t){},492:function(e,t){},494:function(e,t){},508:function(e,t){},510:function(e,t){},523:function(e,t){},525:function(e,t){},532:function(e,t){},536:function(e,t,n){},541:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(262),c=n.n(o),u=(n(273),n(33)),i=n(11),s=n.n(i),l=n(16),m=n(89),f=n(90),p=n(266),v=n(263),d=n(267),h=n(115),b=n.n(h),E=n(20),g=n(31),w=(n(536),r.a.createContext(null)),y=w;function k(){var e=Object(a.useContext)(w);if(null===e)throw new Error("null context causes trouble");return e}var x=n(25);function j(e){var t=Object(a.useState)(""),n=Object(x.a)(t,2),o=n[0],c=n[1];return r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),console.log("submitting ".concat(o)),e.onSubmit(o),c("")}},r.a.createElement("label",null,e.name,":",r.a.createElement("br",null),r.a.createElement("textarea",{value:o,onChange:function(e){return c(e.target.value)}})),r.a.createElement("input",{type:"submit",value:"Submit"}))}function O(e){var t=k(),n=Object(a.useState)(""),o=Object(x.a)(n,2),c=o[0],u=o[1];if(c.length>0)return r.a.createElement(g.a,{to:"/post/".concat(c)});if(!t.username)return r.a.createElement("div",null,"log in to post");var i=t.username;return r.a.createElement(j,{name:"New post",onSubmit:function(){var n=Object(l.a)(s.a.mark(function n(a){var r;return s.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.app.createPost({author:i,board:e.board,content:a});case 2:r=n.sent,u(r.id);case 4:case"end":return n.stop()}},n)}));return function(e){return n.apply(this,arguments)}}()})}function S(e){var t=e.username||"anonymous";return r.a.createElement(E.b,{to:"/u/".concat(t,"/").concat(e.publicKey)},t)}function P(e){var t=function(e,t){return 1===e?"1 ".concat(t," ago"):"".concat(e," ").concat(t,"s ago")},n=(new Date).getTime()-e.getTime();if(n<0)return"in the future";if(n<1e3)return"just now";var a=Math.floor(n/1e3);if(a<60)return t(a,"second");var r=Math.floor(a/60);if(r<60)return t(r,"minute");var o=Math.floor(r/60);if(o<24)return t(o,"hour");var c=Math.floor(o/24);if(c<30)return t(c,"day");var u=Math.floor(c/30);return u<12?t(u,"month"):t(Math.floor(u/12),"year")}function C(e){var t=k(),n=t.comments[e.post.id],a=n?Object.keys(n).length:0,o="".concat(a," comment").concat(1===a?"":"s"),c=t.boards[e.post.data.board];return r.a.createElement("div",null,r.a.createElement("hr",null),e.post.data.content,r.a.createElement("div",null,"posted by"," ",r.a.createElement(S,{username:e.post.data.author,publicKey:e.post.owner})," ",P(e.post.timestamp),c&&r.a.createElement("div",null,"in"," ",r.a.createElement(E.b,{to:"/b/".concat(c.name,"/").concat(c.id)},"b/".concat(c.name)))),r.a.createElement(E.b,{to:"/post/".concat(e.post.id)},o),r.a.createElement("div",null,"score: ",t.votes.getScore(e.post.id)),r.a.createElement("div",{onClick:function(){return t.app.upvote(e.post.id)}},"upvote"),r.a.createElement("div",{onClick:function(){return t.app.downvote(e.post.id)}},"downvote"))}function K(e){return r.a.createElement("div",null,e.posts.map(function(e,t){return r.a.createElement(C,{key:t,post:e})}))}function T(e){var t=k(),n=t.boards[e.id];if(!n)return r.a.createElement("div",null,"board not found");if(e.name&&e.name!==n.name)return r.a.createElement("div",null,"the board has been renamed");var a=[];for(var o in t.posts){var c=t.posts[o];c.data.board===e.id&&a.push(c)}return a.sort(function(e,t){return t.timestamp.getTime()-e.timestamp.getTime()}),r.a.createElement("div",null,r.a.createElement("h2",null,"b/"+n.name),r.a.createElement(O,{board:n.id}),r.a.createElement("hr",null),r.a.createElement(K,{posts:a}))}function D(){var e=k();return e.keyPair?r.a.createElement("div",null,r.a.createElement("p",null,"logged in as ",e.keyPair.getPublicKey()),r.a.createElement("div",{onClick:function(){return e.app.logout()}},"log out")):r.a.createElement(E.b,{to:"/login"},"log in")}function V(){var e=k(),t=[];for(var n in e.posts){var a=e.posts[n];t.push(a)}return t.sort(function(e,t){return t.timestamp.getTime()-e.timestamp.getTime()}),r.a.createElement("div",null,r.a.createElement("h2",null,"Home Page"),r.a.createElement(K,{posts:t}))}function I(){return r.a.createElement("div",null,"loading...")}function M(){var e=k(),t=Object(a.useState)(""),n=Object(x.a)(t,2),o=n[0],c=n[1],u=Object(a.useState)(""),i=Object(x.a)(u,2),s=i[0],l=i[1];if(e.keyPair)return r.a.createElement(g.a,{to:"/"});return r.a.createElement("form",{onSubmit:function(t){t.preventDefault();try{e.app.login(o,s)}catch(t){alert(t),c(""),l("")}}},r.a.createElement("label",null,"username:",r.a.createElement("br",null),r.a.createElement("input",{type:"text",value:o,onChange:function(e){return c(e.target.value)}})),r.a.createElement("br",null),r.a.createElement("label",null,"passphrase:",r.a.createElement("br",null),r.a.createElement("input",{type:"password",value:s,onChange:function(e){return l(e.target.value)}})),r.a.createElement("input",{type:"submit",value:"log in"}))}function B(){var e=Object(a.useState)(""),t=Object(x.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(""),u=Object(x.a)(c,2),i=u[0],m=u[1],f=Object(a.useState)(""),p=Object(x.a)(f,2),v=p[0],d=p[1],h=k();if(!h.username)return r.a.createElement("div",null,"You must log in to create a new board.");if(""!==v)return r.a.createElement(g.a,{to:v});var b=function(){var e=Object(l.a)(s.a.mark(function e(t){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),!(n.length<3)){e.next=4;break}return alert("name too short"),e.abrupt("return");case 4:return console.log("creating board with name: ".concat(n)),e.next=7,h.app.createBoard({description:i},n);case 7:a=e.sent,console.log(a),d("/b/".concat(a.name,"/").concat(a.id));case 10:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("form",{onSubmit:b},r.a.createElement("label",null,"create a new board.",r.a.createElement("br",null),"name:",r.a.createElement("br",null),r.a.createElement("input",{value:n,onChange:function(e){return o(e.target.value.replace(/[\W_]/g,""))}})),r.a.createElement("label",null,"description:",r.a.createElement("br",null),r.a.createElement("textarea",{value:i,onChange:function(e){return m(e.target.value)}})),r.a.createElement("input",{type:"submit",value:"Submit"}))}function A(e){var t=k();if(!t.username)return null;var n=t.username;return r.a.createElement(j,{name:"Reply",onSubmit:function(){var a=Object(l.a)(s.a.mark(function a(r){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.app.createComment({author:n,board:e.post.data.board,content:r,parent:e.post.id});case 2:case"end":return a.stop()}},a)}));return function(e){return a.apply(this,arguments)}}()})}function W(e){var t=k(),n=t.posts[e.id];if(!n)return r.a.createElement("div",null,"post not found");var a=t.comments[e.id],o=[];for(var c in a)o.push(a[c]);return o.sort(function(e,t){return e.timestamp.getTime()-t.timestamp.getTime()}),r.a.createElement("div",null,r.a.createElement("h2",null,"Post Detail (",e.id,")"),n.data.content,o.map(function(e,t){return r.a.createElement("p",{key:t},"Comment: ",e.data.content,r.a.createElement("br",null),"by"," ",r.a.createElement(S,{username:e.data.author,publicKey:e.owner})," ","(",P(e.timestamp),")")}),r.a.createElement(A,{post:n}))}function J(e){var t=k(),n=[];for(var a in t.posts){var o=t.posts[a];o.owner===e.publicKey&&n.push(o)}return n.sort(function(e,t){return t.timestamp.getTime()-e.timestamp.getTime()}),r.a.createElement("div",null,r.a.createElement("h2",null,"posts from ",e.name," (",e.publicKey,"):"),r.a.createElement(K,{posts:n}))}var N=function(){function e(t){Object(m.a)(this,e),this.karma=void 0,this.score=void 0,this.votes=void 0,this.karma={},this.score={},this.votes={};var n=!0,a=!1,r=void 0;try{for(var o,c=t[Symbol.iterator]();!(n=(o=c.next()).done);n=!0){var u=o.value;this.addVote(u)}}catch(i){a=!0,r=i}finally{try{n||null==c.return||c.return()}finally{if(a)throw r}}}return Object(f.a)(e,[{key:"modify",value:function(e,t,n){this.score[e]?this.score[e]+=n:this.score[e]=n,this.karma[t]?this.karma[t]+=n:this.karma[t]=n}},{key:"getScore",value:function(e){return this.score[e]||0}},{key:"getKarma",value:function(e){return this.karma[e]||0}},{key:"getVote",value:function(e,t){var n="".concat(e,":").concat(t);return this.votes[n]||null}},{key:"addVote",value:function(e){if(1===Math.abs(e.data.score)&&e.data.target){var t="".concat(e.owner,":").concat(e.data.target);this.votes[t]&&this.removeVote(this.votes[t]),this.modify(e.data.target,e.owner,e.data.score),this.votes[t]=e}}},{key:"removeVote",value:function(e){var t="".concat(e.owner,":").concat(e.data.target);this.votes[t]===e?(delete this.votes[t],this.modify(e.data.target,e.owner,-e.data.score),e.forget()):console.log("bad removeVote")}}]),e}(),$=function(e){function t(e){var n;Object(m.a)(this,t),(n=Object(p.a)(this,Object(v.a)(t).call(this,e))).channel=void 0,n.postdb=void 0,n.commentdb=void 0,n.votedb=void 0,n.boarddb=void 0;var a=new b.a({network:"alpha",verbose:!0}).createNode();n.channel=a.channel("Axboard"),n.postdb=n.channel.database("Posts");return n.postdb.useFilter(function(e){var t,n=(t=e.timestamp,((new Date).getTime()-t.getTime())/864e5);return!(n>2||n<-.05)}),n.commentdb=n.channel.database("Comments"),n.votedb=n.channel.database("Votes"),n.boarddb=n.channel.database("Boards"),n.state={posts:{},comments:{},votes:new N([]),boards:{},keyPair:void 0,username:void 0,loading:!0},n.loadData(),setTimeout(function(){var e=window.localStorage.getItem("username"),t=window.localStorage.getItem("passphrase");e&&t&&n.login(e,t)},0),n}return Object(d.a)(t,e),Object(f.a)(t,[{key:"loadData",value:function(){var e=Object(l.a)(s.a.mark(function e(){var t,n,a,r,o,c,u,i,l,m,f,p,v,d,h,b,E,g,w,y,k,x,j,O,S,P,C;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postdb.find({selector:{}});case 2:for(t=e.sent,n={},a=!0,r=!1,o=void 0,e.prev=7,c=t[Symbol.iterator]();!(a=(u=c.next()).done);a=!0)i=u.value,n[i.id]=i;e.next=15;break;case 11:e.prev=11,e.t0=e.catch(7),r=!0,o=e.t0;case 15:e.prev=15,e.prev=16,a||null==c.return||c.return();case 18:if(e.prev=18,!r){e.next=21;break}throw o;case 21:return e.finish(18);case 22:return e.finish(15);case 23:return e.next=25,this.commentdb.find({selector:{}});case 25:for(l=e.sent,m={},f=!0,p=!1,v=void 0,e.prev=30,d=l[Symbol.iterator]();!(f=(h=d.next()).done);f=!0)b=h.value,E=b.data.parent,m[E]||(m[E]={}),m[E][b.id]=b;e.next=38;break;case 34:e.prev=34,e.t1=e.catch(30),p=!0,v=e.t1;case 38:e.prev=38,e.prev=39,f||null==d.return||d.return();case 41:if(e.prev=41,!p){e.next=44;break}throw v;case 44:return e.finish(41);case 45:return e.finish(38);case 46:return e.next=48,this.votedb.find({selector:{}});case 48:return g=e.sent,w=new N(g),e.next=52,this.boarddb.find({selector:{}});case 52:for(y=e.sent,k={},x=!0,j=!1,O=void 0,e.prev=57,S=y[Symbol.iterator]();!(x=(P=S.next()).done);x=!0)C=P.value,k[C.id]=C;e.next=65;break;case 61:e.prev=61,e.t2=e.catch(57),j=!0,O=e.t2;case 65:e.prev=65,e.prev=66,x||null==S.return||S.return();case 68:if(e.prev=68,!j){e.next=71;break}throw O;case 71:return e.finish(68);case 72:return e.finish(65);case 73:this.setState({posts:n,comments:m,votes:w,boards:k,loading:!1});case 74:case"end":return e.stop()}},e,this,[[7,11,15,23],[16,,18,22],[30,34,38,46],[39,,41,45],[57,61,65,73],[66,,68,72]])}));return function(){return e.apply(this,arguments)}}()},{key:"createPost",value:function(){var e=Object(l.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.postdb.create(t);case 2:return n=e.sent,this.setState(function(e){var t=Object(u.a)({},e.posts);return t[n.id]=n,Object(u.a)({},e,{posts:t})}),e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createComment",value:function(){var e=Object(l.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.commentdb.create(t);case 2:return n=e.sent,this.setState(function(e){var a=Object(u.a)({},e.comments[t.parent]);a[n.id]=n;var r=Object(u.a)({},e.comments);return r[t.parent]=a,Object(u.a)({},e,{comments:r})}),e.abrupt("return",n);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createBoard",value:function(){var e=Object(l.a)(s.a.mark(function e(t,n){var a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.boarddb.create(t,n);case 2:return a=e.sent,this.setState(function(e){var t=Object(u.a)({},e.boards);return t[a.id]=a,Object(u.a)({},e,{boards:t})}),e.abrupt("return",a);case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"vote",value:function(){var e=Object(l.a)(s.a.mark(function e(t){var n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.votedb.create(t);case 2:return n=e.sent,this.state.votes.addVote(n),this.forceUpdate(),e.abrupt("return",n);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"upvote",value:function(){var e=Object(l.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.vote({target:t,score:1});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"downvote",value:function(){var e=Object(l.a)(s.a.mark(function e(t){return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.vote({target:t,score:-1});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"login",value:function(e,t){if(!/^[A-Za-z0-9_]+$/.test(e))throw new Error("invalid username: ".concat(e));var n=h.KeyPair.fromSecretPhrase(e+";"+t);this.channel.setKeyPair(n),this.setState({keyPair:n,username:e}),window.localStorage.setItem("username",e),window.localStorage.setItem("passphrase",t)}},{key:"logout",value:function(){this.channel.setKeyPair(null),this.setState({keyPair:void 0}),window.localStorage.removeItem("username"),window.localStorage.removeItem("passphrase")}},{key:"render",value:function(){return this.state.loading?r.a.createElement(I,null):r.a.createElement(y.Provider,{value:{app:this,posts:this.state.posts,comments:this.state.comments,votes:this.state.votes,boards:this.state.boards,username:this.state.username,keyPair:this.state.keyPair}},r.a.createElement(E.a,null,r.a.createElement("h1",null,r.a.createElement(E.b,{to:"/"},"Axboard")),r.a.createElement(D,null),r.a.createElement(g.d,null,r.a.createElement(g.b,{path:"/post/:id",render:function(e){var t=e.match;return r.a.createElement(W,{id:t.params.id})}}),r.a.createElement(g.b,{path:"/u/:name/:publicKey",render:function(e){var t=e.match;return r.a.createElement(J,{name:t.params.name,publicKey:t.params.publicKey})}}),r.a.createElement(g.b,{path:"/b/:name/:id",render:function(e){var t=e.match;return r.a.createElement(T,{name:t.params.name,id:t.params.id})}}),r.a.createElement(g.b,{path:"/login"},r.a.createElement(M,null)),r.a.createElement(g.b,{path:"/newboard"},r.a.createElement(B,null)),r.a.createElement(g.b,{path:"/"},r.a.createElement(V,null)))))}}]),t}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement($,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[268,1,2]]]);
//# sourceMappingURL=main.21485c56.chunk.js.map