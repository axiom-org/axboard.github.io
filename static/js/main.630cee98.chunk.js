(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{135:function(t,e){},267:function(t,e,n){t.exports=n(540)},272:function(t,e,n){},294:function(t,e){},334:function(t,e){},336:function(t,e){},349:function(t,e){},351:function(t,e){},359:function(t,e){},361:function(t,e){},371:function(t,e){},373:function(t,e){},381:function(t,e){},383:function(t,e){},391:function(t,e){},392:function(t,e){},394:function(t,e){},396:function(t,e){},398:function(t,e){},411:function(t,e){},416:function(t,e){},418:function(t,e){},427:function(t,e){},431:function(t,e){},432:function(t,e){},433:function(t,e){},440:function(t,e){},442:function(t,e){},447:function(t,e){},451:function(t,e){},452:function(t,e){},455:function(t,e){},461:function(t,e){},464:function(t,e){},466:function(t,e){},478:function(t,e){},480:function(t,e){},491:function(t,e){},493:function(t,e){},507:function(t,e){},509:function(t,e){},522:function(t,e){},524:function(t,e){},531:function(t,e){},535:function(t,e,n){},540:function(t,e,n){"use strict";n.r(e);var a=n(1),r=n.n(a),o=n(259),i=n.n(o),c=(n(272),n(26)),u=n.n(c),s=n(73),m=n(260),l=n(261),f=n(265),p=n(262),d=n(266),h=n(86),v=n.n(h),b=n(87),E=n(28),w=(n(535),r.a.createContext({})),y=n(88);function g(t){var e=Object(a.useState)(""),n=Object(y.a)(e,2),o=n[0],i=n[1];return r.a.createElement("form",{onSubmit:function(e){e.preventDefault(),console.log("submitting ".concat(o)),t.onSubmit(o),i("")}},r.a.createElement("label",null,t.name,":",r.a.createElement("br",null),r.a.createElement("input",{type:t.password?"password":"text",value:o,onChange:function(t){return i(t.target.value)}})),r.a.createElement("input",{type:"submit",value:"Submit"}))}function k(){return r.a.createElement("div",null,"loading...")}function P(t){return r.a.createElement(g,{name:"Log in with your passphrase to post or comment",password:!0,onSubmit:function(e){var n=h.KeyPair.fromSecretPhrase(e);t.onSubmit(n)}})}function O(t){var e=function(t,e){return 1===t?"1 ".concat(e," ago"):"".concat(t," ").concat(e,"s ago")},n=(new Date).getTime()-t.getTime();if(n<0)return"in the future";if(n<1e3)return"just now";var a=Math.floor(n/1e3);if(a<60)return e(a,"second");var r=Math.floor(a/60);if(r<60)return e(r,"minute");var o=Math.floor(r/60);if(o<24)return e(o,"hour");var i=Math.floor(o/24);if(i<30)return e(i,"day");var c=Math.floor(i/30);return c<12?e(c,"month"):e(Math.floor(c/12),"year")}function x(t){var e=Object(a.useState)(t.comments),n=Object(y.a)(e,2),o=n[0],i=n[1];return r.a.createElement("div",null,r.a.createElement("hr",null),r.a.createElement("p",null,r.a.createElement(b.b,{to:"/post/"+t.post.id},"Post: ",t.post.data.content," (posted ",O(t.post.timestamp),")")),o.map(function(t,e){return r.a.createElement("p",{key:e},"Comment: ",t.data.content," (",O(t.timestamp),")")}),t.allowReply&&r.a.createElement(g,{name:"Reply",onSubmit:function(){var e=Object(s.a)(u.a.mark(function e(n){var a,r,c;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.post.id,r={parent:a,content:n},e.next=4,t.commentdb.create(r);case 4:c=e.sent,i([c].concat(o));case 6:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}))}function S(t){var e=Object(a.useContext)(w);if(!e.comments)throw new Error("TODO: need to reload");var n=e.comments[t.id],o=[];for(var i in n)o.push(n[i]);return o.sort(function(t,e){return t.timestamp.getTime()-e.timestamp.getTime()}),r.a.createElement("div",null,r.a.createElement("h2",null,"Post Detail (",t.id,")"),o.map(function(t,e){return r.a.createElement("p",{key:e},"Comment: ",t.data.content," (",O(t.timestamp),")")}))}var j=function(t){function e(t){var n;Object(m.a)(this,e),(n=Object(f.a)(this,Object(p.a)(e).call(this,t))).channel=void 0,n.postdb=void 0,n.commentdb=void 0;var a=new v.a({network:"alpha",verbose:!0}).createNode();n.channel=a.channel("Axboard"),n.postdb=n.channel.database("Posts");return n.postdb.useFilter(function(t){var e,n=(e=t.timestamp,((new Date).getTime()-e.getTime())/864e5);return!(n>2||n<-.05)}),n.commentdb=n.channel.database("Comments"),n.state={posts:[],comments:{},keyPair:void 0,loading:!0},n.loadMainView(),n}return Object(d.a)(e,t),Object(l.a)(e,[{key:"sortedComments",value:function(t){var e=[];for(var n in this.state.comments[t])e.push(this.state.comments[t][n]);return e.sort(function(t,e){return t.timestamp.getTime()-e.timestamp.getTime()}),e}},{key:"loadMainView",value:function(){var t=Object(s.a)(u.a.mark(function t(){var e,n,a,r,o,i,c,s,m,l;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.postdb.find({selector:{}});case 2:return(e=t.sent).sort(function(t,e){return e.timestamp.getTime()-t.timestamp.getTime()}),t.next=6,this.commentdb.find({selector:{}});case 6:for(n=t.sent,a={},r=!0,o=!1,i=void 0,t.prev=11,c=n[Symbol.iterator]();!(r=(s=c.next()).done);r=!0)m=s.value,l=m.data.parent,a[l]||(a[l]={}),a[l][m.id]=m;t.next=19;break;case 15:t.prev=15,t.t0=t.catch(11),o=!0,i=t.t0;case 19:t.prev=19,t.prev=20,r||null==c.return||c.return();case 22:if(t.prev=22,!o){t.next=25;break}throw i;case 25:return t.finish(22);case 26:return t.finish(19);case 27:this.setState({posts:e,comments:a,loading:!1});case 28:case"end":return t.stop()}},t,this,[[11,15,19,27],[20,,22,26]])}));return function(){return t.apply(this,arguments)}}()},{key:"renderHeader",value:function(){var t=this;return this.state.keyPair?r.a.createElement("div",null,r.a.createElement("p",null,"logged in as ",this.state.keyPair.getPublicKey()),r.a.createElement(g,{name:"New post",onSubmit:function(){var e=Object(s.a)(u.a.mark(function e(n){var a,r;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a={content:n},e.next=3,t.postdb.create(a);case 3:r=e.sent,t.setState(function(t){return{posts:[r].concat(t.posts)}});case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()})):r.a.createElement(P,{onSubmit:function(e){t.channel.setKeyPair(e),t.setState({keyPair:e})}})}},{key:"renderPostList",value:function(){var t=this;return r.a.createElement("div",null,r.a.createElement("h2",null,"Home Page"),this.state.posts.map(function(e,n){return r.a.createElement(x,{key:n,post:e,comments:t.sortedComments(e.id),commentdb:t.commentdb,allowReply:!!t.state.keyPair})}))}},{key:"renderPostDetail",value:function(t){return r.a.createElement("div",null,r.a.createElement("h2",null,"Post Detail (",t,")"),r.a.createElement("p",null,"TODO: implement me"))}},{key:"render",value:function(){return this.state.loading?r.a.createElement(k,null):r.a.createElement(w.Provider,{value:{app:this,posts:this.state.posts,comments:this.state.comments,keyPair:this.state.keyPair}},r.a.createElement("div",null,r.a.createElement("h1",null,"Axboard"),this.renderHeader(),r.a.createElement(b.a,null,r.a.createElement(E.c,null,r.a.createElement(E.a,{path:"/post/:id",render:function(t){var e=t.match;return r.a.createElement(S,{id:e.params.id})}}),r.a.createElement(E.a,{path:"/"},this.renderPostList())))))}}]),e}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(j,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[267,1,2]]]);
//# sourceMappingURL=main.630cee98.chunk.js.map